{"ast":null,"code":"import Qs from \"qs\";\nimport Moment from \"moment\";\nexport default {\n  name: \"Comment\",\n\n  data() {\n    return {\n      content: '',\n      topic: {},\n      comments: [],\n      commentUserName: ''\n    };\n  },\n\n  computed: {\n    isShowDelete() {\n      return commentName => this.showDelete(commentName);\n    }\n\n  },\n\n  mounted() {\n    this.$axios.post('http://localhost:8080/topic/selectTopicById', Qs.stringify({\n      topicId: this.$route.query.comment_target\n    })).then(response => {\n      this.topic = response.data;\n    }, error => {\n      console.log(error);\n    });\n    this.$axios.post('http://localhost:8080/comment/selectCommentByTarget', Qs.stringify({\n      commentTarget: this.$route.query.comment_target\n    })).then(response => {\n      this.comments = response.data;\n    }, error => {\n      this.error(error);\n    });\n  },\n\n  methods: {\n    showDelete(commentName) {\n      let user = JSON.parse(localStorage.getItem('user'));\n\n      if (user !== null && user.name !== '' && user.password !== '') {\n        return user.name === commentName;\n      } else {\n        return false;\n      }\n    },\n\n    succeed() {\n      this.$notify({\n        title: '成功',\n        message: '评论成功',\n        type: 'success'\n      });\n    },\n\n    notLogged() {\n      this.$notify.error({\n        title: '失败',\n        message: '请先登录'\n      });\n    },\n\n    failed() {\n      this.$notify.error({\n        title: '失败',\n        message: '评论失败，服务端错误'\n      });\n    },\n\n    error(message) {\n      this.$notify.error({\n        title: '错误',\n        message: '服务器端错误,错误原因：' + message\n      });\n    },\n\n    emitReturn() {\n      this.$bus.$emit('router', this.$route.query.router);\n    },\n\n    emitSubmit() {\n      if (this.content === '') {\n        this.$notify.error({\n          title: '失败',\n          message: '请输入评论内容'\n        });\n      } else {\n        let user = JSON.parse(localStorage.getItem('user'));\n\n        if (user !== null && user.name !== '' && user.password !== '') {\n          let comment = {\n            commentTarget: this.$route.query.comment_target,\n            commentName: user.name,\n            commentUserName: '张三',\n            commentContent: this.content,\n            commentTime: Moment().format(\"YYYY-MM-DD HH:mm:ss\")\n          };\n          this.$axios.post('http://localhost:8080/comment/createComment', Qs.stringify(comment)).then(response => {\n            if (response.data === 1) {\n              this.succeed();\n              this.content = '';\n              this.$axios.post('http://localhost:8080/comment/selectCommentByTarget', Qs.stringify({\n                commentTarget: this.$route.query.comment_target\n              })).then(response => {\n                this.comments = response.data;\n              }, error => {\n                this.error(error);\n              });\n            } else {\n              this.failed();\n            }\n          }, error => {\n            this.error(error);\n          });\n        } else {\n          this.notLogged();\n        }\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAmEA;AACA;AACA;EACAA,eADA;;EAEAC;IACA;MACAC,WADA;MAEAC,SAFA;MAGAC,YAHA;MAIAC;IAJA;EAMA,CATA;;EAUAC;IACAC;MACA;IACA;;EAHA,CAVA;;EAeAC;IACA,gEACAC;MAAAC;IAAA,EADA,EACAC,IADA,CAEAC;MACA;IACA,CAJA,EAKAC;MACAC;IACA,CAPA;IAUA,wEACAL;MAAAM;IAAA,EADA,EACAJ,IADA,CAEAC;MACA;IACA,CAJA,EAKAC;MACA;IACA,CAPA;EASA,CAnCA;;EAoCAG;IACAC;MACA;;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA;IACA,CARA;;IASAC;MACA;QACAC,WADA;QAEAC,eAFA;QAGAC;MAHA;IAKA,CAfA;;IAgBAC;MACA;QACAH,WADA;QAEAC;MAFA;IAIA,CArBA;;IAsBAG;MACA;QACAJ,WADA;QAEAC;MAFA;IAIA,CA3BA;;IA4BAP;MACA;QACAM,WADA;QAEAC;MAFA;IAIA,CAjCA;;IAkCAI;MACA;IACA,CApCA;;IAqCAC;MACA;QACA;UACAN,WADA;UAEAC;QAFA;MAIA,CALA,MAKA;QACA;;QACA;UACA;YACAL,+CADA;YAEAW,sBAFA;YAGArB,qBAHA;YAIAsB,4BAJA;YAKAC;UALA;UAOA,4FACAhB;YACA;cACA;cACA;cACA,wEACAH;gBAAAM;cAAA,EADA,EACAJ,IADA,CAEAC;gBACA;cACA,CAJA,EAKAC;gBACA;cACA,CAPA;YASA,CAZA,MAYA;cACA;YACA;UACA,CAjBA,EAkBAA;YACA;UACA,CApBA;QAsBA,CA9BA,MA8BA;UACA;QACA;MACA;IACA;;EA/EA;AApCA","names":["name","data","content","topic","comments","commentUserName","computed","isShowDelete","mounted","Qs","topicId","then","response","error","console","commentTarget","methods","showDelete","succeed","title","message","type","notLogged","failed","emitReturn","emitSubmit","commentName","commentContent","commentTime"],"sourceRoot":"src/pages","sources":["Comment.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <br><br><br><br>\r\n    <article class=\"media\">\r\n      <figure class=\"media-left\">\r\n        <p class=\"image is-64x64\">\r\n          <img src=\"../assets/logo.png\">\r\n        </p>\r\n      </figure>\r\n      <div class=\"media-content\">\r\n        <div class=\"content\">\r\n          <p>\r\n            <strong>{{ topic.topicUserName }}({{ topic.topicName }})</strong> <small>{{ topic.topicTime }}</small>\r\n            <br>\r\n            {{ topic.topicContent }}\r\n          </p>\r\n        </div>\r\n      </div>\r\n      <el-button type=\"danger\" @click=\"emitReturn\">返回</el-button>\r\n    </article>\r\n\r\n    <!--进行评论-->\r\n    <article class=\"media\">\r\n      <figure class=\"media-left\">\r\n        <p class=\"image is-64x64\">\r\n          <img src=\"../assets/logo.png\">\r\n        </p>\r\n      </figure>\r\n      <div class=\"media-content\">\r\n        <div class=\"field\">\r\n          <p class=\"control\">\r\n            <textarea class=\"textarea\" placeholder=\"请输入评论内容\" v-model=\"content\"></textarea>\r\n          </p>\r\n        </div>\r\n        <nav class=\"level\">\r\n          <div class=\"level-left\">\r\n            <div class=\"level-item\">\r\n              <a class=\"button is-info\" @click=\"emitSubmit\">发送</a>\r\n            </div>\r\n          </div>\r\n        </nav>\r\n      </div>\r\n    </article>\r\n    <el-divider></el-divider>\r\n\r\n    <!--评论区-->\r\n    <article class=\"media\" v-for=\"comment in comments\" :key=\"comment.commentId\">\r\n      <figure class=\"media-left\">\r\n        <p class=\"image is-64x64\">\r\n          <img src=\"../assets/logo.png\">\r\n        </p>\r\n      </figure>\r\n      <div class=\"media-content\">\r\n        <div class=\"content\">\r\n          <p>\r\n            <strong>{{ comment.commentUserName }}({{ comment.commentName }})</strong> <small>{{ comment.commentTime }}</small>\r\n            <br>\r\n            {{ comment.commentContent }}\r\n          </p>\r\n          <el-button type=\"danger\" plain v-if=\"isShowDelete(comment.commentName)\">删除评论</el-button>\r\n        </div>\r\n      </div>\r\n    </article>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import Qs from \"qs\"\r\n  import Moment from \"moment\";\r\n  export default {\r\n    name: \"Comment\",\r\n    data(){\r\n      return {\r\n        content:'',\r\n        topic:{},\r\n        comments:[],\r\n        commentUserName:'',\r\n      }\r\n    },\r\n    computed:{\r\n      isShowDelete(){\r\n        return commentName => this.showDelete(commentName)\r\n      }\r\n    },\r\n    mounted() {\r\n      this.$axios.post('http://localhost:8080/topic/selectTopicById',\r\n        Qs.stringify({topicId:this.$route.query.comment_target})).then(\r\n            response => {\r\n              this.topic = response.data\r\n            },\r\n            error => {\r\n              console.log(error)\r\n            }\r\n      )\r\n\r\n      this.$axios.post('http://localhost:8080/comment/selectCommentByTarget',\r\n          Qs.stringify({commentTarget:this.$route.query.comment_target})).then(\r\n              response => {\r\n                this.comments = response.data\r\n              },\r\n              error => {\r\n                this.error(error)\r\n              }\r\n      )\r\n    },\r\n    methods:{\r\n      showDelete(commentName){\r\n        let user = JSON.parse(localStorage.getItem('user'));\r\n        if (user !== null && user.name !== '' && user.password !== ''){\r\n          return user.name === commentName\r\n        }else {\r\n          return false\r\n        }\r\n      },\r\n      succeed() {\r\n        this.$notify({\r\n          title: '成功',\r\n          message: '评论成功',\r\n          type: 'success'\r\n        });\r\n      },\r\n      notLogged() {\r\n        this.$notify.error({\r\n          title: '失败',\r\n          message: '请先登录',\r\n        });\r\n      },\r\n      failed() {\r\n        this.$notify.error({\r\n          title: '失败',\r\n          message: '评论失败，服务端错误',\r\n        });\r\n      },\r\n      error(message) {\r\n        this.$notify.error({\r\n          title: '错误',\r\n          message: '服务器端错误,错误原因：' + message,\r\n        });\r\n      },\r\n      emitReturn(){\r\n        this.$bus.$emit('router',this.$route.query.router)\r\n      },\r\n      emitSubmit(){\r\n        if (this.content === ''){\r\n          this.$notify.error({\r\n            title: '失败',\r\n            message: '请输入评论内容',\r\n          });\r\n        }else {\r\n          let user = JSON.parse(localStorage.getItem('user'));\r\n          if (user !== null && user.name !== '' && user.password !== ''){\r\n            let comment = {\r\n              commentTarget:this.$route.query.comment_target,\r\n              commentName:user.name,\r\n              commentUserName:'张三',\r\n              commentContent:this.content,\r\n              commentTime:Moment().format(\"YYYY-MM-DD HH:mm:ss\")\r\n            }\r\n            this.$axios.post('http://localhost:8080/comment/createComment',Qs.stringify(comment)).then(\r\n                response => {\r\n                  if (response.data === 1){\r\n                    this.succeed()\r\n                    this.content = ''\r\n                    this.$axios.post('http://localhost:8080/comment/selectCommentByTarget',\r\n                        Qs.stringify({commentTarget:this.$route.query.comment_target})).then(\r\n                        response => {\r\n                          this.comments = response.data\r\n                        },\r\n                        error => {\r\n                          this.error(error)\r\n                        }\r\n                    )\r\n                  }else {\r\n                    this.failed()\r\n                  }\r\n                },\r\n                error => {\r\n                  this.error(error)\r\n                }\r\n            )\r\n          }else {\r\n            this.notLogged()\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}